<!DOCTYPE html>
<html lang="en-us">

  {% include head.html %}

  <body>
    {% if page.layout == "post" or page.layout == "tweet" %}
    <div class="progress-container" aria-hidden="true">
      <div id="reading-progress-bar"></div>
    </div>
    {% endif %}
    <a href="#content" class="skip-link">Skip to main content</a>

    {% include sidebar.html %}

    <div id="content" class="content container">
      {{ content }}
    </div>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        {% if page.layout == "post" or page.layout == "tweet" %}
        const progressBar = document.getElementById('reading-progress-bar');
        if (progressBar) {
          const updateProgress = () => {
            const winScroll = window.scrollY || document.documentElement.scrollTop;
            const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
            const scrolled = height > 0 ? (winScroll / height) * 100 : 0;
            progressBar.style.width = scrolled + '%';
          };
          window.addEventListener('scroll', updateProgress);
          updateProgress();
        }
        {% endif %}

        document.querySelectorAll('pre').forEach((pre) => {
          const code = pre.querySelector('code'); if (!code) return;
          const btn = document.createElement('button');
          btn.className = 'copy-code-button'; btn.innerText = 'Copy';
          const container = pre.parentElement.classList.contains('highlight') ? pre.parentElement : pre;
          if (container === pre) pre.style.position = 'relative';
          container.appendChild(btn);
          btn.onclick = () => {
            navigator.clipboard.writeText(code.innerText.trim()).then(() => {
              btn.innerText = 'Copied!'; btn.classList.add('copied');
              setTimeout(() => { btn.innerText = 'Copy'; btn.classList.remove('copied'); }, 2000);
            });
          };
        });
      });
    </script>
  </body>
</html>
