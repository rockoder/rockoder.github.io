<!DOCTYPE html>
<html lang="en-us">

  {% include head.html %}

  <body>
    {% if page.layout == "post" or page.layout == "tweet" %}
    <div class="progress-container" aria-hidden="true">
      <div id="reading-progress-bar"></div>
    </div>
    {% endif %}
    <a href="#content" class="skip-link">Skip to main content</a>

    {% include sidebar.html %}

    <div id="content" class="content container">
      {{ content }}
    </div>
    <button id="back-to-top" aria-label="Back to top">
      <svg viewBox="0 0 24 24"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"/></svg>
    </button>
    <script>
      const btt = document.getElementById("back-to-top");
      window.onscroll = () => {
        if (window.scrollY > 300) btt.classList.add("show");
        else btt.classList.remove("show");
      };
      btt.onclick = () => window.scrollTo({ top: 0, behavior: "smooth" });
    </script>

    {% include sidebar-right.html %}

    <script>
      document.addEventListener('DOMContentLoaded', () => {
        {% if page.layout == "post" or page.layout == "tweet" %}
        const progressBar = document.getElementById('reading-progress-bar');
        const post = document.querySelector('.post');
        if (progressBar && post) {
          const updateProgress = () => {
            const winScroll = window.scrollY;
            const windowHeight = window.innerHeight;
            const postRect = post.getBoundingClientRect();
            const postBottom = postRect.bottom + winScroll;
            const totalScrollable = postBottom - windowHeight;

            if (totalScrollable <= 0) {
              progressBar.parentElement.style.display = 'none';
            } else {
              progressBar.parentElement.style.display = 'block';
              let percentage = (winScroll / totalScrollable) * 100;
              percentage = Math.max(0, Math.min(100, percentage));
              progressBar.style.width = percentage + '%';
            }
          };
          window.addEventListener('scroll', updateProgress);
          window.addEventListener('resize', updateProgress);
          updateProgress();
        }
        {% endif %}

        document.querySelectorAll('pre').forEach((pre) => {
          const code = pre.querySelector('code'); if (!code) return;
          const btn = document.createElement('button');
          btn.className = 'copy-code-button'; btn.innerText = 'Copy';
          const container = pre.parentElement.classList.contains('highlight') ? pre.parentElement : pre;
          if (container === pre) pre.style.position = 'relative';
          container.appendChild(btn);
          btn.onclick = () => {
            navigator.clipboard.writeText(code.innerText.trim()).then(() => {
              btn.innerText = 'Copied!'; btn.classList.add('copied');
              setTimeout(() => { btn.innerText = 'Copy'; btn.classList.remove('copied'); }, 2000);
            });
          };
        });
      });
    </script>
  </body>
</html>
