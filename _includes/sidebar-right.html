<div class="sidebar-right">

  <!-- Idea #1: Knowledge Graph / Related Concepts -->
  {% if page.layout == 'post' or page.layout == 'tweet' %}
    {% assign related_posts = "" | split: "" %}
    {% for post in site.posts %}
      {% if post.url != page.url %}
        {% assign common_tags = 0 %}
        {% for tag in post.tags %}
          {% if page.tags contains tag %}
            {% assign common_tags = common_tags | plus: 1 %}
          {% endif %}
        {% endfor %}
        {% if common_tags > 0 %}
          {% assign related_posts = related_posts | push: post %}
        {% endif %}
      {% endif %}
    {% endfor %}

    {% if related_posts.size > 0 %}
      <div class="sidebar-section">
        <h3 class="sidebar-right-title">Related Concepts</h3>
        <ul class="sidebar-list">
          {% for post in related_posts limit:5 %}
            <li class="sidebar-list-item">
              <a href="{{ post.url | relative_url }}">{{ post.title }}</a>
            </li>
          {% endfor %}
        </ul>
      </div>
    {% endif %}
  {% endif %}

  <!-- Recently Explored (Fallback or Global) -->
  <div class="sidebar-section">
    <h3 class="sidebar-right-title">Recently Explored</h3>
    <ul class="sidebar-list">
      {% for post in site.posts limit:5 %}
        <li class="sidebar-list-item">
          <a href="{{ post.url | relative_url }}">{{ post.title }}</a>
          <span class="sidebar-metadata">{{ post.date | date: "%B %d, %Y" }}</span>
        </li>
      {% endfor %}
    </ul>
  </div>

  <!-- Idea #2: Current Research / Latest Book (Monetized) -->
  {% assign latest_book = site.data.books | first %}
  {% if latest_book %}
    <div class="sidebar-section">
      <h3 class="sidebar-right-title">Current Research</h3>
      <div class="sidebar-list-item">
        <span class="latest-label">Currently Reading</span>
        <a href="{{ latest_book.link }}" target="_blank" rel="noopener">{{ latest_book.title }}</a>
        <p class="sidebar-metadata" style="margin-top: 0.5rem;">
          Support this research by <a href="{{ latest_book.link }}" target="_blank" rel="noopener">purchasing via this link</a>.
        </p>
      </div>
    </div>
  {% endif %}

  <!-- Latest Writing -->
  {% assign latest_writing = site.data.writing | first %}
  {% if latest_writing %}
    <div class="sidebar-section">
      <h3 class="sidebar-right-title">External Writing</h3>
      <div class="sidebar-list-item">
        <span class="latest-label">Latest Article</span>
        <a href="{{ latest_writing.link }}" target="_blank" rel="noopener">{{ latest_writing.title }}</a>
      </div>
      <a href="{{ '/writing-list/' | relative_url }}" class="sidebar-metadata" style="text-decoration: none;">View full list &rarr;</a>
    </div>
  {% endif %}

</div>
